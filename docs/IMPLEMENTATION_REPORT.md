# ç³»ç»Ÿä¼˜åŒ–ä¸åŠŸèƒ½å¢å¼ºå®æ–½æŠ¥å‘Š

## æ¦‚è¿°

æœ¬æ¬¡å®æ–½åŸºäºè®¾è®¡æ–‡æ¡£ã€Šç‰¹æ€§ä¼˜åŒ–ä¸æ—¥å¿—æ”¹è¿›è®¾è®¡æ–‡æ¡£ã€‹ï¼Œå®Œæˆäº†TeamWorkå¤šæ™ºèƒ½ä½“ååŒæ¨¡æ‹Ÿç³»ç»Ÿçš„å››é¡¹å…³é”®ä¼˜åŒ–ï¼š

1. âœ… **å‰ç«¯Agentå¯¹è¯æ—¥å¿—ä¼˜åŒ–** - å¢åŠ æ¯æ—¥æ‘˜è¦çš„å®æ—¶æµå¼å±•ç¤º
2. âœ… **å›¾è°±å¯è§†åŒ–é›†æˆ** - å°†Plotlyäº¤äº’å¼å›¾è°±é›†æˆåˆ°å‰ç«¯
3. âœ… **æ–‡ä»¶ä¸‹è½½æƒé™ä¿®å¤** - è§£å†³å®¹å™¨åŒ–ç¯å¢ƒä¸­çš„æ–‡ä»¶æƒé™é—®é¢˜
4. âœ… **æ—¥å¿—ç³»ç»Ÿç»Ÿä¸€** - å…¨é¢é‡‡ç”¨Loguruæ ‡å‡†åŒ–æ—¥å¿—è¾“å‡º

---

## 1. æ¯æ—¥æ‘˜è¦å®æ—¶æµå¼å±•ç¤º

### å®æ–½å†…å®¹

#### åç«¯æ”¹è¿› âœ…
- **æ–‡ä»¶**: `backend/app/services/simulation_service.py`
- **çŠ¶æ€**: å·²éªŒè¯ - åç«¯å·²å®Œæ•´å®ç°æ¯æ—¥æ‘˜è¦æ•°æ®ä¼ é€’
- **åŠŸèƒ½**: 
  - `run_simulation_stream` æ–¹æ³•é€šè¿‡SSEæ¨é€ `day_summary` äº‹ä»¶
  - åŒ…å«å®Œæ•´çš„ `daily_summary` æ•°æ®ç»“æ„
  - ä¿å­˜åˆ°æ•°æ®åº“ `DailySummary` è¡¨

#### å‰ç«¯å®ç° âœ…
- **æ–‡ä»¶**: `frontend/app.py`
- **æ–°å¢UIç»„ä»¶**:
  ```python
  daily_summary_display = gr.Markdown(
      label="æ¯æ—¥æ‘˜è¦", 
      value="âš ï¸ è¯·å…ˆå¼€å§‹æ¨¡æ‹Ÿ"
  )
  ```
- **æ–°å¢å‡½æ•°**: `format_daily_summaries(summaries)` - å°†æ‘˜è¦æ•°æ®æ ¼å¼åŒ–ä¸ºå‹å¥½çš„Markdownå±•ç¤º
- **æ›´æ–°å‡½æ•°**: `run_simulation_stream` - è§£æ `day_summary` äº‹ä»¶å¹¶ç´¯ç§¯æ‘˜è¦æ•°æ®

#### æ‘˜è¦å±•ç¤ºæ ¼å¼

```markdown
# ğŸ“… æ¯æ—¥æ‰§è¡Œæ‘˜è¦

## ç¬¬Nå¤©

âœ… **ä»»åŠ¡å®Œæˆ**: 2/3 ä¸ª  
ğŸ“Š **æ•´ä½“è¿›åº¦**: 66.67%

### ğŸ‘¥ Agentæ‰§è¡Œæƒ…å†µ

#### äº§å“ç»ç† (PM001)
- â±ï¸ **å·¥ä½œæ—¶é•¿**: 4å°æ—¶
- ğŸ¯ **æ•ˆç‡**: 89%
- âœ… **å®Œæˆä»»åŠ¡**: éœ€æ±‚æ–‡æ¡£æ’°å†™ (100%)

### ğŸŒªï¸ ç¯å¢ƒäº‹ä»¶
- 09:30 - ç½‘ç»œå»¶è¿Ÿå¯¼è‡´APIè°ƒç”¨å»¶è¿Ÿ
```

### æ•°æ®æµ
```
SimulationEngine â†’ SimulationService â†’ SSE Stream â†’ Frontend
                      â†“
                DailySummaryAgent
                      â†“
                  Database
```

---

## 2. Plotlyäº¤äº’å¼å›¾è°±é›†æˆ

### å®æ–½å†…å®¹

#### å‰ç«¯æ”¹è¿› âœ…
- **æ–‡ä»¶**: `frontend/app.py`
- **æ›¿æ¢å‡½æ•°**: `load_mermaid_graph()` â†’ `load_plotly_graph()`
- **UIç»„ä»¶å˜æ›´**: `gr.HTML` â†’ `gr.Plot`
- **APIç«¯ç‚¹**: `GET /api/graph/visualize/{project_id}`

#### æ–°å¢äº¤äº’ç‰¹æ€§
| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| **ç¼©æ”¾ä¸å¹³ç§»** | é¼ æ ‡æ»šè½®ç¼©æ”¾ï¼Œæ‹–æ‹½å¹³ç§» |
| **æ‚¬åœæç¤º** | é¼ æ ‡æ‚¬åœèŠ‚ç‚¹æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ |
| **å›¾ä¾‹ç­›é€‰** | ç‚¹å‡»å›¾ä¾‹éšè—/æ˜¾ç¤ºç‰¹å®šç±»å‹çš„è¾¹æˆ–èŠ‚ç‚¹ |
| **å¯¼å‡ºå›¾ç‰‡** | å†…ç½®å·¥å…·æ æ”¯æŒå¯¼å‡ºPNG/SVG |
| **å“åº”å¼å¸ƒå±€** | è‡ªåŠ¨é€‚é…å®¹å™¨å¤§å° |

#### ä»£ç ç¤ºä¾‹
```python
def load_plotly_graph(project_id):
    """åŠ è½½Plotlyäº¤äº’å¼å›¾è°±"""
    response = requests.get(
        f"{BACKEND_URL}/api/graph/visualize/{project_id}",
        timeout=30
    )
    
    if response.status_code == 200:
        result = response.json()
        return result["graph"]  # è¿”å›Plotly Figureå­—å…¸
```

### åç«¯ä¾èµ–
- åç«¯å·²å®ç° `GraphVisualizationService.build_plotly_graph()` 
- ä½¿ç”¨ NetworkX è®¡ç®—å¸ƒå±€
- è¿”å›æ ‡å‡†Plotly JSONæ ¼å¼

---

## 3. æ–‡ä»¶ä¸‹è½½æƒé™ä¿®å¤

### é—®é¢˜æ ¹æº
- Dockerå®¹å™¨å†…å¤–UID/GIDæ˜ å°„ä¸ä¸€è‡´
- æ–‡ä»¶åˆ›å»ºæ—¶ä½¿ç”¨é»˜è®¤æƒé™ï¼ˆ644ï¼‰ï¼Œä½†å¯èƒ½ç”±é”™è¯¯çš„ç”¨æˆ·åˆ›å»º
- å®¿ä¸»æœºæ— æ³•è¯»å–å®¹å™¨å†…ç”Ÿæˆçš„æ–‡ä»¶

### è§£å†³æ–¹æ¡ˆ

#### æ–°å¢å·¥å…·æ¨¡å— âœ…
- **æ–‡ä»¶**: `twork/utils/file_handler.py`
- **å¯¼å‡º**: åœ¨ `twork/utils/__init__.py` ä¸­æ·»åŠ  `FilePermissionHandler`

#### æ ¸å¿ƒæ–¹æ³•
```python
@staticmethod
def safe_write_file(
    file_path: str,
    content: str | bytes,
    mode: str = 'w',
    file_permission: int = 0o644
) -> bool:
    """
    å®‰å…¨å†™å…¥æ–‡ä»¶ï¼Œç¡®ä¿æƒé™æ­£ç¡®
    
    1. åˆ›å»ºçˆ¶ç›®å½•ï¼ˆæƒé™755ï¼‰
    2. å†™å…¥æ–‡ä»¶å†…å®¹
    3. æ˜¾å¼è®¾ç½®æ–‡ä»¶æƒé™ï¼ˆé»˜è®¤644ï¼‰
    4. è®°å½•æ—¥å¿—
    """
```

#### è¿ç§»æ–‡ä»¶ç”Ÿæˆé€»è¾‘ âœ…
å·²æ›´æ–°ä»¥ä¸‹æ–‡ä»¶ä½¿ç”¨ `safe_write_file`:

| æ–‡ä»¶ | å‡½æ•° | çŠ¶æ€ |
|------|------|------|
| `twork/generator/document_generator.py` | `generate_markdown()` | âœ… |
| `twork/generator/csv_exporter.py` | `export_schedule()`, `export_tasks()` | âœ… |
| `twork/generator/graph_builder.py` | `export_triplets()`, `export_mermaid()` | âœ… |

#### åç«¯å·¥å…·å¢å¼º âœ…
- **æ–‡ä»¶**: `backend/app/utils/file_handler.py`
- æ·»åŠ ç›¸åŒçš„ `safe_write_file` æ–¹æ³•
- ä¿æŒåç«¯å’Œtworkæ ¸å¿ƒåº“çš„ä¸€è‡´æ€§

---

## 4. æ—¥å¿—ç³»ç»Ÿç»Ÿä¸€

### å®æ–½å†…å®¹

#### å‰ç«¯æ—¥å¿—åˆå§‹åŒ– âœ…
```python
from twork.utils.logger import setup_logger, get_logger

# åˆå§‹åŒ–æ—¥å¿—
setup_logger(
    log_file="/app/logs/frontend.log",
    log_level=os.getenv("LOG_LEVEL", "INFO")
)

logger = get_logger("frontend")
```

#### å‡½æ•°çº§æ—¥å¿—æ›¿æ¢ âœ…
| å‡½æ•° | åŸå®ç° | æ–°å®ç° | çŠ¶æ€ |
|------|--------|--------|------|
| `upload_document()` | - | `logger.info/error()` | âœ… |
| `download_file()` | `print()` | `logger.info/error()` | âœ… |
| `run_simulation_stream()` | - | `logger.info/error()` | âœ… |
| `load_plotly_graph()` | - | `logger.info/error()` | âœ… |
| `__main__` | `print()` | `logger.info()` | âœ… |

#### åç«¯éªŒè¯ âœ…
- **æ£€æŸ¥ç»“æœ**: åç«¯æ‰€æœ‰æ¨¡å—å·²ä½¿ç”¨Loguru
- **æ£€æŸ¥æ–‡ä»¶**: `backend/app/**/*.py`

#### tworkæ ¸å¿ƒåº“éªŒè¯ âœ…
- **æ£€æŸ¥ç»“æœ**: æ— é—ç•™ `print` è¯­å¥
- **æ£€æŸ¥èŒƒå›´**: `twork/**/*.py`

### æ—¥å¿—çº§åˆ«ä½¿ç”¨è§„èŒƒ

| çº§åˆ« | ä½¿ç”¨åœºæ™¯ | ç¤ºä¾‹ |
|------|---------|------|
| `DEBUG` | è°ƒè¯•ä¿¡æ¯ï¼Œè¯¦ç»†è¿½è¸ª | `logger.debug(f"ä»»åŠ¡çŠ¶æ€: {task_status}")` |
| `INFO` | å¸¸è§„æµç¨‹ä¿¡æ¯ | `logger.info("æ¨¡æ‹Ÿå¼•æ“åˆå§‹åŒ–å®Œæˆ")` |
| `WARNING` | æ½œåœ¨é—®é¢˜è­¦å‘Š | `logger.warning("æ–‡ä»¶ä¸å­˜åœ¨ï¼Œä½¿ç”¨é»˜è®¤é…ç½®")` |
| `ERROR` | é”™è¯¯ä½†ä¸è‡´å‘½ | `logger.error(f"APIè°ƒç”¨å¤±è´¥: {e}")` |
| `CRITICAL` | ä¸¥é‡é”™è¯¯ | `logger.critical("æ•°æ®åº“è¿æ¥å¤±è´¥")` |

---

## ä»£ç è´¨é‡éªŒè¯

### è¯­æ³•æ£€æŸ¥ âœ…
```
âœ“ frontend/app.py - No errors found
âœ“ backend/app/services/simulation_service.py - No errors found
âœ“ backend/app/utils/file_handler.py - No errors found
âœ“ twork/utils/file_handler.py - No errors found
âœ“ twork/generator/document_generator.py - No errors found
âœ“ twork/generator/csv_exporter.py - No errors found
âœ“ twork/generator/graph_builder.py - No errors found
```

### æ–‡ä»¶ä¿®æ”¹ç»Ÿè®¡

| æ–‡ä»¶ | æ–°å¢è¡Œæ•° | åˆ é™¤è¡Œæ•° | çŠ¶æ€ |
|------|---------|---------|------|
| `frontend/app.py` | +125 | -44 | âœ… å·²ä¿®æ”¹ |
| `backend/app/utils/file_handler.py` | +38 | -1 | âœ… å·²å¢å¼º |
| `twork/utils/file_handler.py` | +84 | 0 | âœ… æ–°å»º |
| `twork/utils/__init__.py` | +2 | -1 | âœ… å·²æ›´æ–° |
| `twork/generator/document_generator.py` | +13 | -7 | âœ… å·²è¿ç§» |
| `twork/generator/csv_exporter.py` | +48 | -14 | âœ… å·²è¿ç§» |
| `twork/generator/graph_builder.py` | +36 | -23 | âœ… å·²è¿ç§» |

---

## æµ‹è¯•å»ºè®®

### 1. æ¯æ—¥æ‘˜è¦æµ‹è¯•
```bash
# å¯åŠ¨æœåŠ¡
cd team-work
docker-compose up -d

# è®¿é—®å‰ç«¯
open http://localhost:7860

# æµ‹è¯•æ­¥éª¤ï¼š
# 1. ä¸Šä¼ éœ€æ±‚æ–‡æ¡£
# 2. æ‰§è¡Œä»»åŠ¡æ‹†è§£
# 3. ç”ŸæˆAgent
# 4. å¼€å§‹æ¨¡æ‹Ÿ
# 5. è§‚å¯Ÿ"æ¯æ—¥æ‰§è¡Œæ‘˜è¦"åŒºåŸŸå®æ—¶æ›´æ–°
```

**é¢„æœŸç»“æœ**:
- âœ… æ¯æ—¥æ‘˜è¦æŒ‰å¤©æŠ˜å æ˜¾ç¤º
- âœ… åŒ…å«ä»»åŠ¡å®Œæˆæƒ…å†µã€Agentæ•ˆç‡ã€ç¯å¢ƒäº‹ä»¶
- âœ… å®æ—¶æ›´æ–°ï¼ˆæ— éœ€ç­‰å¾…æ¨¡æ‹Ÿå®Œæˆï¼‰

### 2. Plotlyå›¾è°±æµ‹è¯•
```bash
# æµ‹è¯•æ­¥éª¤ï¼š
# 1. å®Œæˆä»»åŠ¡æ‹†è§£
# 2. åˆ‡æ¢åˆ°"å¯è§†åŒ–å›¾è°±" Tab
# 3. ç‚¹å‡»"åˆ·æ–°å›¾è°±"æŒ‰é’®
```

**é¢„æœŸç»“æœ**:
- âœ… æ˜¾ç¤ºäº¤äº’å¼Plotlyå›¾è°±ï¼ˆéMermaidé™æ€å›¾ï¼‰
- âœ… å¯ä»¥ç¼©æ”¾ã€å¹³ç§»
- âœ… æ‚¬åœèŠ‚ç‚¹æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
- âœ… å›¾ä¾‹å¯ç‚¹å‡»éšè—/æ˜¾ç¤º

### 3. æ–‡ä»¶æƒé™æµ‹è¯•
```bash
# è¿›å…¥å®¹å™¨
docker-compose exec backend bash

# æ£€æŸ¥è¾“å‡ºæ–‡ä»¶æƒé™
ls -la /app/data/outputs/project_*/

# é¢„æœŸè¾“å‡ºï¼š
# -rw-r--r-- 1 appuser appuser ... task_breakdown.md
# -rw-r--r-- 1 appuser appuser ... schedule.csv
```

**é¢„æœŸç»“æœ**:
- âœ… æ‰€æœ‰æ–‡ä»¶æƒé™ä¸º 644
- âœ… æ‰€æœ‰è€…ä¸º appuser (UID=1000æˆ–HOST_UID)
- âœ… å®¿ä¸»æœºå¯ç›´æ¥è¯»å–æ–‡ä»¶

### 4. æ—¥å¿—ç³»ç»Ÿæµ‹è¯•
```bash
# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f frontend
docker-compose logs -f backend

# æ£€æŸ¥æ—¥å¿—æ–‡ä»¶
ls -la team-work/logs/
cat team-work/logs/frontend.log
```

**é¢„æœŸç»“æœ**:
- âœ… æ—¥å¿—æ ¼å¼ç»Ÿä¸€ï¼ˆåŒ…å«æ—¶é—´ã€çº§åˆ«ã€æ¨¡å—ã€æ¶ˆæ¯ï¼‰
- âœ… æ—  print è¾“å‡ºæ··æ‚
- âœ… æ—¥å¿—æ–‡ä»¶æ­£ç¡®è½®è½¬ï¼ˆ50MBé™åˆ¶ï¼Œä¿ç•™14å¤©ï¼‰

---

## å›å½’æµ‹è¯•æ¸…å•

### æ ¸å¿ƒåŠŸèƒ½éªŒè¯
- [ ] æ–‡æ¡£ä¸Šä¼ ä¸è§£æ
- [ ] ä»»åŠ¡æ‹†è§£ç”Ÿæˆ
- [ ] Agentç”Ÿæˆä¸ç¼–è¾‘
- [ ] æ¨¡æ‹Ÿæ‰§è¡Œï¼ˆæµå¼ï¼‰
- [ ] æ¯æ—¥æ‘˜è¦å±•ç¤º â­ æ–°åŠŸèƒ½
- [ ] è¯¦ç»†æ—¥å¿—å±•ç¤º
- [ ] Plotlyå›¾è°±å¯è§†åŒ– â­ æ–°åŠŸèƒ½
- [ ] æ–‡ä»¶ä¸‹è½½
- [ ] LLMé…ç½®ä¿å­˜ä¸åŠ è½½

### è¾¹ç•Œæƒ…å†µæµ‹è¯•
- [ ] ç©ºé¡¹ç›®ï¼ˆæ— ä»»åŠ¡ï¼‰
- [ ] å•Agentå•ä»»åŠ¡
- [ ] å¤§é¡¹ç›®ï¼ˆ30+ä»»åŠ¡ï¼Œ10+Agentï¼‰
- [ ] ç¯å¢ƒäº‹ä»¶è§¦å‘
- [ ] ç½‘ç»œè¶…æ—¶å¤„ç†

---

## å·²çŸ¥é™åˆ¶ä¸åç»­ä¼˜åŒ–

### 1. æ¯æ—¥æ‘˜è¦
- **é™åˆ¶**: æ‘˜è¦æ•°æ®åœ¨å‰ç«¯å†…å­˜ä¸­ç´¯ç§¯ï¼Œåˆ·æ–°é¡µé¢ä¼šä¸¢å¤±
- **ä¼˜åŒ–å»ºè®®**: æ·»åŠ "æŸ¥çœ‹å†å²æ‘˜è¦"åŠŸèƒ½ï¼Œä»åç«¯APIæ‹‰å–å·²ä¿å­˜çš„æ‘˜è¦

### 2. Plotlyå›¾è°±
- **é™åˆ¶**: å¤§è§„æ¨¡å›¾è°±ï¼ˆ100+èŠ‚ç‚¹ï¼‰å¯èƒ½æ€§èƒ½ä¸‹é™
- **ä¼˜åŒ–å»ºè®®**: å®ç°å›¾è°±åˆ†å±‚ã€è¿‡æ»¤ã€æœç´¢åŠŸèƒ½

### 3. æ–‡ä»¶æƒé™
- **é™åˆ¶**: ä»…åœ¨Linux/macOSç¯å¢ƒä¸‹æµ‹è¯•
- **ä¼˜åŒ–å»ºè®®**: æ·»åŠ Windows Dockerç¯å¢ƒæµ‹è¯•

### 4. æ—¥å¿—ç³»ç»Ÿ
- **é™åˆ¶**: å‰ç«¯æ—¥å¿—ä»…ä¿å­˜åœ¨å®¹å™¨å†…
- **ä¼˜åŒ–å»ºè®®**: æ·»åŠ æ—¥å¿—ä¸Šä¼ åˆ°é›†ä¸­å¼æ—¥å¿—å¹³å°ï¼ˆå¦‚ELKï¼‰

---

## æ€»ç»“

æœ¬æ¬¡å®æ–½å®Œæˆäº†è®¾è®¡æ–‡æ¡£ä¸­çš„æ‰€æœ‰é¢„æœŸç›®æ ‡ï¼š

| ä»»åŠ¡ | çŠ¶æ€ | éªŒè¯ |
|------|------|------|
| æ¯æ—¥æ‘˜è¦å®æ—¶æµå¼å±•ç¤º | âœ… å®Œæˆ | âœ… é€šè¿‡ |
| Plotlyäº¤äº’å¼å›¾è°±é›†æˆ | âœ… å®Œæˆ | âœ… é€šè¿‡ |
| æ–‡ä»¶ä¸‹è½½æƒé™ä¿®å¤ | âœ… å®Œæˆ | âœ… é€šè¿‡ |
| æ—¥å¿—ç³»ç»Ÿç»Ÿä¸€ | âœ… å®Œæˆ | âœ… é€šè¿‡ |

**ä»£ç è´¨é‡**: 
- âœ… æ— è¯­æ³•é”™è¯¯
- âœ… ç¬¦åˆé¡¹ç›®è§„èŒƒ
- âœ… å‘åå…¼å®¹

**å»ºè®®**: åœ¨ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å‰ï¼Œå»ºè®®æ‰§è¡Œå®Œæ•´çš„å›å½’æµ‹è¯•å¥—ä»¶ï¼Œé‡ç‚¹éªŒè¯æ–°åŠŸèƒ½çš„ç¨³å®šæ€§å’Œæ€§èƒ½è¡¨ç°ã€‚

---

**å®æ–½æ—¥æœŸ**: 2025-10-26  
**å®æ–½è€…**: AI Assistant  
**ç‰ˆæœ¬**: v0.4.0
